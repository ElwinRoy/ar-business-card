<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>MindAR â€” AR Video + Buttons in Scene</title>

    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <style>
      body { margin:0; overflow:hidden; font-family:Arial, sans-serif; }

      #note, #markerStatus {
        position:absolute; z-index:2; color:#fff;
        padding:8px 12px; border-radius:8px; font-size:13px;
      }
      #note   { left:8px; top:8px; background:rgba(0,0,0,0.65); }
      #markerStatus { right:8px; top:8px; background:rgba(200,0,0,0.7); }
      #markerStatus.found { background:rgba(0,150,0,0.7); }

      #controls {
        position:fixed; bottom:30px; left:50%; transform:translateX(-50%);
        z-index:9999; background:rgba(0,0,0,0.85); padding:15px 25px;
        border-radius:12px; display:none; gap:15px; align-items:center;
      }
      #controls.visible { display:flex !important; }

      .control-btn {
        background:#2196F3; color:#fff; border:none; width:50px; height:50px;
        border-radius:50%; cursor:pointer; font-size:20px; display:flex;
        align-items:center; justify-content:center; box-shadow:0 4px 8px rgba(0,0,0,0.3);
        transition:all .3s;
      }
      .control-btn:hover { transform:scale(1.1); box-shadow:0 6px 12px rgba(0,0,0,0.4); }
      .control-btn:active { transform:scale(.95); }

      #playPauseBtn { background:#2196F3; width:60px; height:60px; font-size:24px; }
      #playPauseBtn.playing { background:#FFC107; }
      #restartBtn { background:#4CAF50; }
      #muteBtn { background:#FF9800; }
      #muteBtn.unmuted { background:#4CAF50; }
    </style>
  </head>
  <body>
    <div id="note">
      Point your camera at the <strong>Image Target</strong>.<br>Allow camera access when prompted.
    </div>
    <div id="markerStatus">Target Not Found</div>

    <div id="controls">
      <button id="restartBtn" class="control-btn" title="Restart">â†»</button>
      <button id="playPauseBtn" class="control-btn" title="Play/Pause">â–¶</button>
      <button id="muteBtn" class="control-btn" title="Mute/Unmute">ðŸ”‡</button>
    </div>

    <a-scene
      mindar-image="imageTargetSrc: https://cdn.jsdelivr.net/gh/Gitboi46/ar-car-demo/targets.mind;"
      color-space="sRGB"
      renderer="colorManagement:true; physicallyCorrectLights:true;"
      vr-mode-ui="enabled:false"
      device-orientation-permission-ui="enabled:false"
    >
      <a-assets>
        <video id="video"
               src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
               preload="auto" loop crossorigin="anonymous"></video>
      </a-assets>

      <a-camera 
        position="0 0 0" 
        look-controls="enabled:false"
        cursor="fuse:false; rayOrigin:mouse;"
        raycaster="objects:.clickable">
      </a-camera>

      <a-entity mindar-image-target="targetIndex:0">

        <a-plane id="video-plane"
                 position="0 0 0.001" rotation="0 0 0"
                 width="1.6" height="0.9"
                 material="shader:flat; src:#video;"></a-plane>

        <a-plane position="0 0 0" rotation="0 0 0"
                 width="2" height="1.3"
                 color="#000000" material="opacity:0.9; transparent:true;"></a-plane>

        <a-plane id="callBtnAR" class="clickable"
                 position="-0.45 -0.55 0.01"
                 width="0.7" height="0.15"
                 color="#2196F3"
                 material="shader:flat; opacity:0.9; transparent:true;"
                 visible="false">
          <a-text value="Call Now"
                  align="center" color="#fff"
                  width="2.5" position="0 0 0.01"></a-text>
        </a-plane>

        <a-plane id="websiteBtnAR" class="clickable"
                 position="0.45 -0.55 0.01"
                 width="0.7" height="0.15"
                 color="#FF5722"
                 material="shader:flat; opacity:0.9; transparent:true;"
                 visible="false">
          <a-text value="Visit Website"
                  align="center" color="#fff"
                  width="2.5" position="0 0 0.01"></a-text>
        </a-plane>
      </a-entity>

      <a-entity light="type:ambient; intensity:1; color:#ffffff"></a-entity>
    </a-scene>

    <script>
      const sceneEl      = document.querySelector('a-scene');
      const video        = document.getElementById('video');
      const markerStatus = document.getElementById('markerStatus');
      const playPauseBtn = document.getElementById('playPauseBtn');
      const muteBtn      = document.getElementById('muteBtn');
      const restartBtn   = document.getElementById('restartBtn');
      const controls     = document.getElementById('controls');
      const callBtnAR    = document.getElementById('callBtnAR');
      const websiteBtnAR = document.getElementById('websiteBtnAR');

      let isPlaying = false;
      let isMuted   = true;
      video.muted = true;

      playPauseBtn.addEventListener('click', () => {
        if (isPlaying) {
          pauseVideo();
          playPauseBtn.textContent = 'â–¶';
          playPauseBtn.classList.remove('playing');
        } else {
          playVideo();
          playPauseBtn.textContent = 'â¸';
          playPauseBtn.classList.add('playing');
        }
      });

      muteBtn.addEventListener('click', () => {
        isMuted = !isMuted;
        video.muted = isMuted;
        muteBtn.textContent = isMuted ? 'ðŸ”‡' : 'ðŸ”Š';
        muteBtn.classList.toggle('unmuted', !isMuted);
      });

      restartBtn.addEventListener('click', () => {
        video.currentTime = 0;
        if (!isPlaying) {
          playVideo();
          playPauseBtn.textContent = 'â¸';
          playPauseBtn.classList.add('playing');
        }
      });

      AFRAME.registerComponent('link-trigger', {
        schema: {action: {type: 'string'}},
        init: function () {
          this.el.addEventListener('click', () => {
            const action = this.data.action;
            if (action === 'call') {
              console.log('Call button clicked');
              window.location.href = 'tel:+919902319932';
            } else if (action === 'website') {
              console.log('Website button clicked');
              window.open('https://4point2tech.com/', '_blank');
            }
          });
        }
      });

      sceneEl.addEventListener('targetFound', () => {
        markerStatus.classList.add('found');
        markerStatus.textContent = 'Target Found';
        controls.classList.add('visible');

        callBtnAR.setAttribute('visible', true);
        websiteBtnAR.setAttribute('visible', true);

        callBtnAR.setAttribute('link-trigger', 'action: call');
        websiteBtnAR.setAttribute('link-trigger', 'action: website');

        if (!isPlaying) {
          playVideo();
          playPauseBtn.textContent = 'â¸';
          playPauseBtn.classList.add('playing');
        }
      });

      sceneEl.addEventListener('targetLost', () => {
        markerStatus.classList.remove('found');
        markerStatus.textContent = 'Target Not Found';
        controls.classList.remove('visible');
        callBtnAR.setAttribute('visible', false);
        websiteBtnAR.setAttribute('visible', false);
        pauseVideo();
        playPauseBtn.textContent = 'â–¶';
        playPauseBtn.classList.remove('playing');
      });

      function playVideo() {
        video.play().then(() => { isPlaying = true; })
        .catch(err => console.error('Play error:', err));
      }

      function pauseVideo() {
        video.pause();
        isPlaying = false;
      }

      sceneEl.addEventListener('arReady', () => console.log('MindAR ready'));
      sceneEl.addEventListener('arError', e => console.error('MindAR error:', e.detail));
    </script>
  </body>
</html>
